/*
 * To change this template, choose Tools | Templates
 * and open the template in the editor.
 */

/*
 * LibraryGUI.java
 *
 * Created on 28-Sep-2009, 11:55:39
 */

package library;

import java.io.*;
import java.util.Enumeration;
import javax.swing.JOptionPane;
import java.util.Hashtable;
import javax.swing.AbstractButton;
/**
 *
 * @author Kutoma
 */
public class LibraryGUI extends javax.swing.JFrame {

    private SetOfMembers theMembers = new SetOfMembers();
    private SetOfBooks holdings = new SetOfBooks();


    /** Creates new form LibraryGUI */
    public LibraryGUI() {

        initComponents();

        try {
            deserializeData();
            updateAccNumsForMemberAndBooks();
            updateMemberListJList();
            updateBookListJList();
        }
        catch (IOException | ClassNotFoundException e) {
            System.out.println("Not found file, thus using default initials");
            Member member1 = new Member("Jane");
            Member member2 = new Member("Amir");
            Member member3 = new Member("Astrid");
            Member member4 = new Member("Andy");

            theMembers.addMember(member1);
            theMembers.addMember(member2);
            theMembers.addMember(member3);
            theMembers.addMember(member4);

            Book book1 = new Book("American Gods", "Neil Gaiman", "1234");
            Book book2 = new Book("The Circle", "Dave Eggers", "5678");
            Book book3 = new Book("Pride and Justice", "Jane Austen", "9874");
            Book book4 = new Book("The Handmaid's Tale", "Margaret Atwood", "3478");
            Book book5 = new Book("Myths", "Neil Gaiman", "3434");
            Book book6 = new Book("Grandioze", "Dave Eggers", "9889");

            holdings.addBook(book1);
            holdings.addBook(book2);
            holdings.addBook(book3);
            holdings.addBook(book4);
            holdings.addBook(book5);
            holdings.addBook(book6);

            member1.borrowBook(book1);
            member2.borrowBook(book2);

            memberList.setListData(theMembers.toArray());
            bookList.setListData(holdings.toArray());
        }
    }




        /** This method is called from within the constructor to
         * initialize the form.
         * WARNING: Do NOT modify this code. The content of this method is
         * always regenerated by the Form Editor.
         */
        @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        searchCriteriaBtnGroup = new javax.swing.ButtonGroup();
        jScrollPane2 = new javax.swing.JScrollPane();
        bookList = new javax.swing.JList();
        jScrollPane1 = new javax.swing.JScrollPane();
        memberList = new javax.swing.JList();
        jLabel1 = new javax.swing.JLabel();
        jLabel2 = new javax.swing.JLabel();
        searchTxtField = new javax.swing.JTextField();
        jLabel3 = new javax.swing.JLabel();
        searchBtn = new javax.swing.JButton();
        titleRadioBtn = new javax.swing.JRadioButton();
        authorRadioBtn = new javax.swing.JRadioButton();
        isbnRadioBtn = new javax.swing.JRadioButton();
        memberRadioBtn = new javax.swing.JRadioButton();
        showAllBooksBtn = new javax.swing.JButton();
        showBooksNotOnLoanBtn = new javax.swing.JButton();
        showMembersBtn = new javax.swing.JButton();
        acceptBookReturnBtn = new javax.swing.JButton();
        loanBookToMemberBtn = new javax.swing.JButton();
        jSeparator1 = new javax.swing.JSeparator();
        jLabel4 = new javax.swing.JLabel();
        jLabel5 = new javax.swing.JLabel();
        bookNameTxtField = new javax.swing.JTextField();
        jLabel6 = new javax.swing.JLabel();
        jLabel7 = new javax.swing.JLabel();
        bookAuthorTxtField = new javax.swing.JTextField();
        jLabel8 = new javax.swing.JLabel();
        bookIsbnTxtField = new javax.swing.JTextField();
        addBookBtn = new javax.swing.JButton();
        memberNameTxtField = new javax.swing.JTextField();
        jLabel9 = new javax.swing.JLabel();
        addMemberBtn = new javax.swing.JButton();
        showMemberBorrowedBooksBtn = new javax.swing.JButton();
        accNumRadioBtn = new javax.swing.JRadioButton();

        setDefaultCloseOperation(javax.swing.WindowConstants.EXIT_ON_CLOSE);
        addWindowListener(new java.awt.event.WindowAdapter() {
            public void windowClosing(java.awt.event.WindowEvent evt) {
                formWindowClosing(evt);
            }
        });

        bookList.setModel(new javax.swing.AbstractListModel() {
            String[] strings = { "Item 1", "Item 2", "Item 3", "Item 4", "Item 5" };
            public int getSize() { return strings.length; }
            public Object getElementAt(int i) { return strings[i]; }
        });
        bookList.setSelectionMode(javax.swing.ListSelectionModel.SINGLE_SELECTION);
        jScrollPane2.setViewportView(bookList);

        memberList.setModel(new javax.swing.AbstractListModel() {
            String[] strings = { "Item 1", "Item 2", "Item 3", "Item 4", "Item 5" };
            public int getSize() { return strings.length; }
            public Object getElementAt(int i) { return strings[i]; }
        });
        memberList.setSelectionMode(javax.swing.ListSelectionModel.SINGLE_SELECTION);
        jScrollPane1.setViewportView(memberList);

        jLabel1.setText("Books");

        jLabel2.setText("Members");

        jLabel3.setText("Search:");

        searchBtn.setText("Search");
        searchBtn.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                searchBtnActionPerformed(evt);
            }
        });

        searchCriteriaBtnGroup.add(titleRadioBtn);
        titleRadioBtn.setSelected(true);
        titleRadioBtn.setText("Title");

        searchCriteriaBtnGroup.add(authorRadioBtn);
        authorRadioBtn.setText("Author");

        searchCriteriaBtnGroup.add(isbnRadioBtn);
        isbnRadioBtn.setText("ISBN");

        searchCriteriaBtnGroup.add(memberRadioBtn);
        memberRadioBtn.setText("Member");

        showAllBooksBtn.setText("Show all books");
        showAllBooksBtn.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                showAllBooksBtnActionPerformed(evt);
            }
        });

        showBooksNotOnLoanBtn.setText("Show books not on loan");
        showBooksNotOnLoanBtn.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                showBooksNotOnLoanBtnActionPerformed(evt);
            }
        });

        showMembersBtn.setText("Show all members");
        showMembersBtn.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                showMembersBtnActionPerformed(evt);
            }
        });

        acceptBookReturnBtn.setText("Accept book return");
        acceptBookReturnBtn.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                acceptBookReturnBtnActionPerformed(evt);
            }
        });

        loanBookToMemberBtn.setText("Loan a book");
        loanBookToMemberBtn.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                loanBookToMemberBtnActionPerformed(evt);
            }
        });

        jSeparator1.setOrientation(javax.swing.SwingConstants.VERTICAL);

        jLabel4.setFont(new java.awt.Font("Noto Sans", 0, 24)); // NOI18N
        jLabel4.setText("New Member");

        jLabel5.setFont(new java.awt.Font("Noto Sans", 0, 24)); // NOI18N
        jLabel5.setText("New Book");

        jLabel6.setText("Name");

        jLabel7.setText("Author");

        jLabel8.setText("ISBN");

        addBookBtn.setText("Add a book");
        addBookBtn.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                addBookBtnActionPerformed(evt);
            }
        });

        jLabel9.setText("Name");

        addMemberBtn.setText("Add a member");
        addMemberBtn.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                addMemberBtnActionPerformed(evt);
            }
        });

        showMemberBorrowedBooksBtn.setText("Show member's books");
        showMemberBorrowedBooksBtn.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                showMemberBorrowedBooksBtnActionPerformed(evt);
            }
        });

        searchCriteriaBtnGroup.add(accNumRadioBtn);
        accNumRadioBtn.setText("AccNumber");

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(getContentPane());
        getContentPane().setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(layout.createSequentialGroup()
                        .addContainerGap()
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(showAllBooksBtn, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                            .addComponent(showBooksNotOnLoanBtn, javax.swing.GroupLayout.DEFAULT_SIZE, 185, Short.MAX_VALUE))
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                                .addGroup(layout.createSequentialGroup()
                                    .addComponent(acceptBookReturnBtn, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                                    .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                    .addComponent(loanBookToMemberBtn, javax.swing.GroupLayout.PREFERRED_SIZE, 200, javax.swing.GroupLayout.PREFERRED_SIZE)
                                    .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                    .addComponent(showMemberBorrowedBooksBtn, javax.swing.GroupLayout.PREFERRED_SIZE, 200, javax.swing.GroupLayout.PREFERRED_SIZE))
                                .addComponent(jScrollPane2, javax.swing.GroupLayout.PREFERRED_SIZE, 616, javax.swing.GroupLayout.PREFERRED_SIZE))
                            .addComponent(jLabel1)))
                    .addGroup(layout.createSequentialGroup()
                        .addGap(65, 65, 65)
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addGroup(layout.createSequentialGroup()
                                .addComponent(searchTxtField, javax.swing.GroupLayout.PREFERRED_SIZE, 350, javax.swing.GroupLayout.PREFERRED_SIZE)
                                .addGap(18, 18, 18)
                                .addComponent(searchBtn))
                            .addGroup(layout.createSequentialGroup()
                                .addComponent(titleRadioBtn)
                                .addGap(18, 18, 18)
                                .addComponent(authorRadioBtn)
                                .addGap(18, 18, 18)
                                .addComponent(isbnRadioBtn)
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                .addComponent(memberRadioBtn)
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                .addComponent(accNumRadioBtn))
                            .addComponent(jLabel3))))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                    .addComponent(showMembersBtn, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                    .addComponent(jScrollPane1, javax.swing.GroupLayout.PREFERRED_SIZE, 163, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addGroup(layout.createSequentialGroup()
                        .addGap(50, 50, 50)
                        .addComponent(jLabel2)))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(jSeparator1, javax.swing.GroupLayout.PREFERRED_SIZE, 18, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(layout.createSequentialGroup()
                        .addGap(48, 48, 48)
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(addBookBtn, javax.swing.GroupLayout.Alignment.TRAILING, javax.swing.GroupLayout.PREFERRED_SIZE, 314, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                                .addGroup(layout.createSequentialGroup()
                                    .addComponent(jLabel8)
                                    .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                                    .addComponent(bookIsbnTxtField, javax.swing.GroupLayout.PREFERRED_SIZE, 242, javax.swing.GroupLayout.PREFERRED_SIZE))
                                .addGroup(layout.createSequentialGroup()
                                    .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                                        .addComponent(jLabel7)
                                        .addComponent(jLabel6))
                                    .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING, false)
                                        .addGroup(layout.createSequentialGroup()
                                            .addGap(65, 65, 65)
                                            .addComponent(jLabel5)
                                            .addGap(93, 93, 93))
                                        .addGroup(javax.swing.GroupLayout.Alignment.LEADING, layout.createSequentialGroup()
                                            .addGap(32, 32, 32)
                                            .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                                                .addComponent(bookNameTxtField, javax.swing.GroupLayout.PREFERRED_SIZE, 242, javax.swing.GroupLayout.PREFERRED_SIZE)
                                                .addComponent(bookAuthorTxtField, javax.swing.GroupLayout.PREFERRED_SIZE, 242, javax.swing.GroupLayout.PREFERRED_SIZE)))))))
                        .addContainerGap(119, Short.MAX_VALUE))
                    .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, layout.createSequentialGroup()
                        .addGap(61, 61, 61)
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, layout.createSequentialGroup()
                                .addComponent(jLabel4)
                                .addGap(69, 69, 69))
                            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, layout.createSequentialGroup()
                                .addComponent(jLabel9)
                                .addGap(30, 30, 30)
                                .addComponent(memberNameTxtField, javax.swing.GroupLayout.PREFERRED_SIZE, 237, javax.swing.GroupLayout.PREFERRED_SIZE))
                            .addComponent(addMemberBtn, javax.swing.GroupLayout.Alignment.TRAILING, javax.swing.GroupLayout.PREFERRED_SIZE, 307, javax.swing.GroupLayout.PREFERRED_SIZE))
                        .addGap(64, 64, 64))))
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addContainerGap()
                .addComponent(jLabel3)
                .addGap(11, 11, 11)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(layout.createSequentialGroup()
                        .addGap(7, 7, 7)
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addGroup(layout.createSequentialGroup()
                                .addComponent(jLabel5)
                                .addGap(163, 163, 163)
                                .addComponent(addBookBtn))
                            .addGroup(layout.createSequentialGroup()
                                .addGap(56, 56, 56)
                                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                                    .addComponent(bookNameTxtField, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                                    .addComponent(jLabel6))
                                .addGap(18, 18, 18)
                                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                                    .addComponent(jLabel7)
                                    .addComponent(bookAuthorTxtField, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                                    .addComponent(jLabel8)
                                    .addComponent(bookIsbnTxtField, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))))
                        .addContainerGap())
                    .addGroup(layout.createSequentialGroup()
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                            .addComponent(searchTxtField, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addComponent(searchBtn))
                        .addGap(18, 18, 18)
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                            .addComponent(titleRadioBtn)
                            .addComponent(authorRadioBtn)
                            .addComponent(isbnRadioBtn)
                            .addComponent(memberRadioBtn)
                            .addComponent(accNumRadioBtn))
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addGroup(layout.createSequentialGroup()
                                .addGap(25, 25, 25)
                                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                                    .addGroup(layout.createSequentialGroup()
                                        .addComponent(jLabel1)
                                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                                            .addGroup(layout.createSequentialGroup()
                                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                                                .addComponent(jScrollPane2, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                                            .addGroup(layout.createSequentialGroup()
                                                .addGap(29, 29, 29)
                                                .addComponent(showAllBooksBtn)
                                                .addGap(18, 18, 18)
                                                .addComponent(showBooksNotOnLoanBtn)))
                                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                                            .addComponent(showMemberBorrowedBooksBtn)
                                            .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                                                .addComponent(acceptBookReturnBtn)
                                                .addComponent(loanBookToMemberBtn))))
                                    .addGroup(layout.createSequentialGroup()
                                        .addComponent(jLabel2)
                                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                                        .addComponent(jScrollPane1, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                        .addComponent(showMembersBtn)))
                                .addContainerGap(154, Short.MAX_VALUE))
                            .addGroup(layout.createSequentialGroup()
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                                .addComponent(jLabel4)
                                .addGap(29, 29, 29)
                                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                                    .addComponent(memberNameTxtField, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                                    .addComponent(jLabel9))
                                .addGap(26, 26, 26)
                                .addComponent(addMemberBtn)
                                .addGap(54, 54, 54))))))
            .addComponent(jSeparator1, javax.swing.GroupLayout.Alignment.TRAILING)
        );

        jLabel1.getAccessibleContext().setAccessibleName("sdfsdf");

        pack();
    }// </editor-fold>//GEN-END:initComponents

    private void addBookBtnActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_addBookBtnActionPerformed
        try {
        Hashtable<String, String> table = getInfoFromAddBookTxtFields();
        holdings.addBook(new Book(table.get("name"), table.get("author"), table.get("isbn")));
        updateBookListJList();
        } catch (Exception e)
        {
            displayCustomMessageDialog(e.getMessage());
        }
    }//GEN-LAST:event_addBookBtnActionPerformed

    private void showAllBooksBtnActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_showAllBooksBtnActionPerformed
        updateBookListJList();
    }//GEN-LAST:event_showAllBooksBtnActionPerformed

    private void showMembersBtnActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_showMembersBtnActionPerformed
        updateMemberListJList();
    }//GEN-LAST:event_showMembersBtnActionPerformed

    private void showBooksNotOnLoanBtnActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_showBooksNotOnLoanBtnActionPerformed
        insertNotOnLoanBooksIntoJList();
    }//GEN-LAST:event_showBooksNotOnLoanBtnActionPerformed

    private void loanBookToMemberBtnActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_loanBookToMemberBtnActionPerformed
        //Checking for unselected book and member from two JList instances.
        try {
            loanBook(getSelectedBookFromJList(), getSelectedMemberFromJList());
            insertNotOnLoanBooksIntoJList();
        }
        catch (Exception e)
        {
            displayCustomMessageDialog(e.getMessage());
        }
    }//GEN-LAST:event_loanBookToMemberBtnActionPerformed

    private void acceptBookReturnBtnActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_acceptBookReturnBtnActionPerformed
        try {
            Member selectedMember = getSelectedMemberFromJList();
            acceptReturn(getSelectedBookFromJList(), selectedMember);
            updateBookListJList(selectedMember.getBooksOnLoan());
        }
        catch (Exception e)
        {
            displayCustomMessageDialog(e.getMessage());
        }
    }//GEN-LAST:event_acceptBookReturnBtnActionPerformed

    private void showMemberBorrowedBooksBtnActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_showMemberBorrowedBooksBtnActionPerformed
        try{
        updateBookListJList(getCurrentLoansFromMember(getSelectedMemberFromJList()));
        } catch(Exception e) {
            displayCustomMessageDialog(e.getMessage());
        }
    }//GEN-LAST:event_showMemberBorrowedBooksBtnActionPerformed

    private void addMemberBtnActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_addMemberBtnActionPerformed
        try{
            String name = getInfoFromAddMemberTxtField();
            theMembers.addMember(new Member(name));
            updateMemberListJList();
        } catch(Exception e){
            displayCustomMessageDialog(e.getMessage());
        }

    }//GEN-LAST:event_addMemberBtnActionPerformed

    private void searchBtnActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_searchBtnActionPerformed
        try {
        String selectedButtonName = getNameFromSelectedRadioBtn();
        String searchText = getTxtFromSearchTxtField();
        SetOfBooks foundResults;
        switch(selectedButtonName)
        {
            case "title":
                foundResults = holdings.findBooksByTitle(searchText);
                updateBookListJList(foundResults);
                break;
            case "author":
                foundResults = holdings.findBooksByAuthor(searchText);
                updateBookListJList(foundResults);
                break;
            case "isbn":
                foundResults = holdings.findBooksByISBN(searchText);
                updateBookListJList(foundResults);
                break;
            case "member":
                SetOfMembers members = theMembers.getMembersFromName(searchText);
                updateMemberListJList(members);
                break;
            case "accnumber":
                int enteredAccNumber = Integer.decode(searchText);
                Book foundBook = holdings.findBookByAccNumber(enteredAccNumber);
                foundResults = new SetOfBooks();
                if(foundBook != null)
                    foundResults.addBook(foundBook);
                updateBookListJList(foundResults);
                break;
            default:
                System.out.println("Hmm, something is not right with the switch statement");
        }
        } catch(Exception e)
        {
            displayCustomMessageDialog(e.getMessage());
        }
    }//GEN-LAST:event_searchBtnActionPerformed

    private void formWindowClosing(java.awt.event.WindowEvent evt) {//GEN-FIRST:event_formWindowClosing
        try {
            System.out.println("Right, the window is getting closed");
        serializeData();
        }
        catch (IOException | ClassNotFoundException e){
            displayCustomMessageDialog("Ooops, it didn't like saving for some reason");
        }
    }//GEN-LAST:event_formWindowClosing

    /**
    * @param args the command line arguments
    */
    public static void main(String args[]) {
        java.awt.EventQueue.invokeLater(new Runnable() {

            @Override
            public void run() {
                new LibraryGUI().setVisible(true);
            }

        });
    }
    
    private void updateAccNumsForMemberAndBooks()
    {
        holdings.get(0).setAccNumber(holdings.size());
        theMembers.get(0).setMemberCount(theMembers.size());
    }

    //Serialization methods for initialisation of the program
    private void serializeData() throws IOException, ClassNotFoundException
    {
        String dataFile = "objectdata.ser";

        ObjectOutputStream out = new ObjectOutputStream(new BufferedOutputStream(new FileOutputStream(dataFile)));
        out.writeObject(holdings);
        out.writeObject(theMembers);
        out.close();
    }

    private void deserializeData() throws IOException, ClassNotFoundException
    {
        String dataFile = "objectdata.ser";

        ObjectInputStream in = new ObjectInputStream(new BufferedInputStream(new FileInputStream(dataFile)));
        holdings = (SetOfBooks) in.readObject();
        theMembers = (SetOfMembers) in.readObject();
        in.close();
    }

    //Methods used by buttons

    private void loanBook(Book selectedBook, Member selectedMember) throws Exception
    {
        //Check if a book is already borrowed
        if(selectedBook.isOnLoan())
            throw new Exception("The book you selected is already on loan");
        //Check if a member has loaned 3 books already
        if(selectedMember.getBooksOnLoan().size() >= 3)
            throw new Exception("The member already borrowed three books");
        //Loan a book to a member
        selectedMember.borrowBook(selectedBook);
    }

    private void acceptReturn(Book selectedBook, Member selectedMember) throws Exception
    {
        //Check if a book is not on loan
        if(!selectedBook.isOnLoan())
            throw new Exception("The selected book is not on loan");
        //Check if the book belongs to the member
        if(selectedMember != selectedBook.getBorrower())
            throw new Exception("The book belongs to a different borrower");
        selectedMember.returnBook(selectedBook);
    }

    private SetOfBooks getCurrentLoansFromMember(Member selectedMember)
    {
        return selectedMember.getBooksOnLoan();
    }

    //private void s

    private SetOfBooks getNotOnLoanBooksList()
    {
        SetOfBooks notOnLoanBooksList = new SetOfBooks();
        for(Book book : holdings) {
            if(!book.isOnLoan())
                notOnLoanBooksList.addBook(book);
        }
        return notOnLoanBooksList;
    }





    //----------------------------------

    private String getNameFromSelectedRadioBtn() throws Exception
    {
        for (Enumeration<AbstractButton> buttons = searchCriteriaBtnGroup.getElements(); buttons.hasMoreElements();) {
            AbstractButton button = buttons.nextElement();

            if (button.isSelected()) {
                return button.getText().toLowerCase();
            }
        }

        throw new Exception("A radio button is not selected");
    }

    private String getTxtFromSearchTxtField() throws Exception
    {
        String trimmedText = searchTxtField.getText().trim();
        if(trimmedText.length() == 0)
            throw new Exception("Text field is either empty or contains white space");
        return trimmedText;
    }

    private Hashtable<String, String> getInfoFromAddBookTxtFields() throws Exception
    {
        Hashtable<String, String> table = new Hashtable<String, String>();
        try{
            table.put("name", bookNameTxtField.getText());
            table.put("author", bookAuthorTxtField.getText());
            table.put("isbn", bookIsbnTxtField.getText());
        }
        catch (NullPointerException e){
            throw new Exception("One of your fields is empty");
        }
        //Check for whitespace values
        Enumeration<String> enumKeys = table.keys();
        while(enumKeys.hasMoreElements()) {
        String key = enumKeys.nextElement();
        String trimmed_value = table.get(key).trim();
        if(trimmed_value.length() == 0)
            throw new Exception("One of the fields contain whitespace or it's just empty");
        table.put(key, trimmed_value);
        }
        bookNameTxtField.setText("");
        bookAuthorTxtField.setText("");
        bookIsbnTxtField.setText("");
        return table;
    }

    private String getInfoFromAddMemberTxtField() throws Exception
    {
        String trimmedName = memberNameTxtField.getText().trim();
        if(trimmedName.length() == 0)
            throw new Exception("A field is either empty or contains whitespace");
        memberNameTxtField.setText("");
        return trimmedName;
    }

    private Book getSelectedBookFromJList() throws Exception
    {
        Book selectedBook = (Book) bookList.getSelectedValue();
        if (selectedBook == null)
            throw new Exception("You must select a book");
        return selectedBook;

    }

    private Member getSelectedMemberFromJList() throws Exception
    {
        Member selectedMember = (Member) memberList.getSelectedValue();
        if (selectedMember == null)
            throw new Exception("You must select a member");
        return selectedMember;
    }

    private void updateBookListJList() {

        bookList.setListData(holdings.toArray());
    }

    private void updateBookListJList(SetOfBooks bList) {
        bookList.setListData(bList.toArray());
    }

    private void updateMemberListJList() {
        memberList.setListData(theMembers.toArray());
    }

    private void updateMemberListJList(SetOfMembers memList) {
        memberList.setListData(memList.toArray());
    }

    private void insertNotOnLoanBooksIntoJList()
    {
        SetOfBooks notOnLoanBooksList = getNotOnLoanBooksList();
        updateBookListJList(notOnLoanBooksList);
    }

    private void displayCustomMessageDialog(String txt) {
        JOptionPane.showMessageDialog(null, txt);
    }

    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JRadioButton accNumRadioBtn;
    private javax.swing.JButton acceptBookReturnBtn;
    private javax.swing.JButton addBookBtn;
    private javax.swing.JButton addMemberBtn;
    private javax.swing.JRadioButton authorRadioBtn;
    private javax.swing.JTextField bookAuthorTxtField;
    private javax.swing.JTextField bookIsbnTxtField;
    private javax.swing.JList bookList;
    private javax.swing.JTextField bookNameTxtField;
    private javax.swing.JRadioButton isbnRadioBtn;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JLabel jLabel2;
    private javax.swing.JLabel jLabel3;
    private javax.swing.JLabel jLabel4;
    private javax.swing.JLabel jLabel5;
    private javax.swing.JLabel jLabel6;
    private javax.swing.JLabel jLabel7;
    private javax.swing.JLabel jLabel8;
    private javax.swing.JLabel jLabel9;
    private javax.swing.JScrollPane jScrollPane1;
    private javax.swing.JScrollPane jScrollPane2;
    private javax.swing.JSeparator jSeparator1;
    private javax.swing.JButton loanBookToMemberBtn;
    private javax.swing.JList memberList;
    private javax.swing.JTextField memberNameTxtField;
    private javax.swing.JRadioButton memberRadioBtn;
    private javax.swing.JButton searchBtn;
    private javax.swing.ButtonGroup searchCriteriaBtnGroup;
    private javax.swing.JTextField searchTxtField;
    private javax.swing.JButton showAllBooksBtn;
    private javax.swing.JButton showBooksNotOnLoanBtn;
    private javax.swing.JButton showMemberBorrowedBooksBtn;
    private javax.swing.JButton showMembersBtn;
    private javax.swing.JRadioButton titleRadioBtn;
    // End of variables declaration//GEN-END:variables


}
